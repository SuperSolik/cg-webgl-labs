<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>3D WEBGL LAB1</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js" integrity="sha512-zhHQR0/H5SEBL3Wn6yYSaTTZej12z0hVZKOv3TwCUXT1z5qeqGcXJLLrbERYRScEDDpYIJhPC1fk31gqR783iQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src='/js/utils.js'></script>
    <script src='/js/drawObject.js'></script>
    <script src='/js/main.js'></script>
    <script id="shader-vs" type="x-shader/x-vertex">
        attribute vec3 aVertexPosition;
        attribute vec3 aVertexNormal;

        uniform vec3 uVertexColor;
        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;
        
        // structs 
        struct _light 
        { 
            vec4 diffuse; 
            vec4 ambient; 
            vec3 position; 
        }; 

        struct _material 
        { 
            vec4 diffuse; 
            vec4 ambient; 
        }; 

        const int n = 1; // lights count

        uniform _light lights [n];
        uniform _material material;
        uniform bool lighting;
        vec4 mvPosition; // непроецированная позиция вершины 
        vec3 N;
        varying mediump vec4 vColor;

        vec4 lightCalc(in _light light, in vec3 N, in vec4 mvPosition) {
            vec3 L = normalize(light.position.xyz);// - mvPosition.xyz);
            // Рассчитать коэффициент диффузии
            float Kd = max(dot(L, N), 0.0);
            vec4 color = Kd * (material.diffuse * light.diffuse) + (material.ambient * light.ambient);
            return color;
        }


        void main(void) {
            mvPosition = uModelViewMatrix * vec4(aVertexPosition, 1.0);
            gl_PointSize = 0.1;
            gl_Position = uProjectionMatrix * mvPosition;
            if (lighting == false) { 
                vColor = vec4(uVertexColor, 1.0); 
            } else {
                // Убедитесь, что нормаль на самом деле равна единице длины,
                // и изолировать важные координаты 
                N = normalize((uModelViewMatrix * vec4(aVertexNormal, 0.0)).xyz); 

                // Объединяем цвета от всех источников света 
                vColor.rgb = vec3(0, 0, 0); 
                for (int i = 0; i < n; i++){ 
                    vColor += lightCalc(lights[i], N, mvPosition);     
                } 
                vColor.a = 1.0; // Переопределить альфа из вычислений освещения 
            } 
        }    
    </script>

    <script id="shader-fs" type="x-shader/x-fragment">
        varying mediump vec4 vColor;

        void main(void) {
          gl_FragColor = vColor;
        }
    </script>
</head>

<body>
    <canvas id="glcanvas" class="mainCanvas">
        Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
    </canvas>
    <br>
    <div class="switchContainer">
        <div class="switchText">Ortho Projection</div>
        <label class="switch">
            <input id="oSwitch" type="checkbox" checked>
            <span class="slider round"></span>
        </label>
    </div>
    <br>
    <div class="switchContainer">
        <div class="switchText">Perspective Projection</div>
        <label class="switch">
            <input id="pSwitch" type="checkbox">
            <span class="slider round"></span>
        </label>
    </div>
    <div class="switchContainer">
        <div class="switchText">Use lighting</div>
        <label class="switch">
            <input id="lSwitch" type="checkbox">
            <span class="slider round"></span>
        </label>
    </div>
    <div class="range-slider">
        <input id="lAmbient" class="range-slider__range" type="range" value="100" min="0" max="100">
        <span class="range-slider__value">Light ambient</span>
    </div> 
    <div class="range-slider">
        <input id="lDiffuse" class="range-slider__range" type="range" value="10" min="0" max="100">
        <span class="range-slider__value">Light diffuse</span>
    </div> 
</body>
</html>